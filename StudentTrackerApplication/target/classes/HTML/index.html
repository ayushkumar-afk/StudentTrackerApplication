<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Task Manager Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/style.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="../css/dropdown-panel.css" />
</head>

<body>
    <header class="main-header">
        <div class="logo">ðŸ—‚ Task Manager</div>
        <div class="header-right">
            <button id="profileIconBtn" style="background:none;border:none;cursor:pointer;margin-left:18px;">
                <span class="material-icons" style="font-size:2.1rem;color:#ffc107;">account_circle</span>
            </button>
        </div>
    </header>

    <!-- Navigation Bar -->
    <nav class="main-navbar">
        <ul>
            <li><a href="welcome.html">Welcome</a></li>
            <li><a href="index.html" class="active" id="nav-home">Home</a></li>
            <li><a href="all-tasks.html" id="nav-all-tasks">All Tasks</a></li>
            <li><a href="all-tasks.html#tab-completed" id="nav-completed-tasks">Completed Tasks</a></li>
        </ul>
    </nav>

    <main class="container">
        <section class="dashboard-section" style="text-align:center;padding:48px 0 32px 0;">
            <h1 style="font-size:2.3rem;color:#23405c;margin-bottom:0.5em;">Welcome to Task Manager</h1>
            <p style="font-size:1.2rem;color:#2d3e4e;margin-bottom:2em;">Your personal dashboard for tracking and
                managing student tasks efficiently.</p>
            <div class="dashboard-cards"
                style="display:flex;justify-content:center;gap:32px;flex-wrap:wrap;margin-bottom:2em;">
                <div class="dashboard-card"
                    style="background:#fff;border-radius:14px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:28px 36px;min-width:220px;display:flex;flex-direction:column;align-items:center;">
                    <span class="material-icons"
                        style="font-size:2.5rem;color:#007bff;margin-bottom:8px;">assignment</span>
                    <div style="font-size:2rem;font-weight:700;" id="card-total-tasks">--</div>
                    <div style="color:#23405c;font-size:1.1rem;">Total Tasks</div>
                </div>
                <div class="dashboard-card"
                    style="background:#fff;border-radius:14px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:28px 36px;min-width:220px;display:flex;flex-direction:column;align-items:center;">
                    <span class="material-icons"
                        style="font-size:2.5rem;color:#28a745;margin-bottom:8px;">done_all</span>
                    <div style="font-size:2rem;font-weight:700;" id="card-completed-tasks">--</div>
                    <div style="color:#23405c;font-size:1.1rem;">Completed</div>
                </div>
                <div class="dashboard-card"
                    style="background:#fff;border-radius:14px;box-shadow:0 2px 12px rgba(0,0,0,0.06);padding:28px 36px;min-width:220px;display:flex;flex-direction:column;align-items:center;">
                    <span class="material-icons"
                        style="font-size:2.5rem;color:#ffc107;margin-bottom:8px;">hourglass_empty</span>
                    <div style="font-size:2rem;font-weight:700;" id="card-pending-tasks">--</div>
                    <div style="color:#23405c;font-size:1.1rem;">Pending</div>
                </div>
            </div>
            <div style="display:flex;justify-content:center;gap:32px;flex-wrap:wrap;">
                <a href="all-tasks.html" class="btn btn-primary"
                    style="font-size:1.1rem;padding:18px 36px;display:flex;align-items:center;gap:10px;">
                    <span class="material-icons" style="font-size:2rem;">assignment</span> View All Tasks
                </a>
                <a href="all-tasks.html?filter=completed" class="btn"
                    style="font-size:1.1rem;padding:18px 36px;display:flex;align-items:center;gap:10px;background:#ffc107;color:#23405c;">
                    <span class="material-icons" style="font-size:2rem;">done_all</span> Completed Tasks
                </a>
            </div>
            <div class="recent-activity"
                style="margin:3em auto 0 auto;max-width:600px;text-align:left;background:#f7f9fa;border-radius:12px;padding:24px 32px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                <h2 style="font-size:1.3rem;color:#23405c;margin-bottom:1em;display:flex;align-items:center;gap:8px;">
                    <span class="material-icons" style="color:#007bff;">history</span> Recent Activity
                </h2>
                <ul id="recent-activity-list" style="padding-left:1.2em;margin:0;font-size:1.08rem;color:#2d3e4e;"></ul>
            </div>
            <div style="margin-top:2.5em;font-style:italic;color:#174a7c;font-size:1.15rem;">
                <span class="material-icons" style="vertical-align:middle;color:#ffc107;">emoji_objects</span>
                "Success is the sum of small efforts, repeated day in and day out." â€“ Robert Collier
            </div>
            <div style="margin-top:3em;">
                <img src="https://img.freepik.com/free-vector/flat-education-background_23-2149070167.jpg?w=900&t=st=1719820000~exp=1719820600~hmac=student"
                    alt="Student Task Tracker"
                    style="max-width:420px;width:100%;border-radius:16px;box-shadow:0 2px 16px rgba(0,0,0,0.07);margin-top:2em;">
            </div>
        </section>
    </main>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal" style="display:none;z-index:2000;">
        <div class="modal-content"
            style="max-width:420px;margin:auto;padding:0 0 24px 0;border-radius:18px;overflow:hidden;">
            <div
                style="background:linear-gradient(90deg,#007bff 60%,#ffc107 100%);height:90px;width:100%;position:relative;">
                <span class="close" id="closeProfileModal"
                    style="font-size:2rem;cursor:pointer;position:absolute;top:18px;right:28px;color:#fff;z-index:2;">&times;</span>
                <span class="material-icons"
                    style="font-size:4.5rem;color:#fff;position:absolute;left:50%;top:60px;transform:translate(-50%,0);background:#fff;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.08);padding:8px;">account_circle</span>
            </div>
            <div style="padding:64px 28px 0 28px;display:flex;flex-direction:column;align-items:center;">
                <div id="profileName" style="font-size:1.35rem;font-weight:700;color:#23405c;margin-bottom:2px;">User
                    Name</div>
                <div id="profileEmail" style="color:#888;font-size:1.02rem;margin-bottom:2px;">user@email.com</div>
                <div id="profileRole"
                    style="color:#fff;background:#007bff;padding:2px 14px;border-radius:8px;font-size:0.98rem;margin-bottom:1.2em;">
                    Role</div>
                <button id="viewMyTasksBtn" class="btn btn-primary"
                    style="width:100%;font-size:1.1rem;margin-bottom:1.2em;display:flex;align-items:center;justify-content:center;gap:8px;">
                    <span class="material-icons" style="vertical-align:middle;">assignment_ind</span> View My Tasks
                </button>
                <button id="profileLogoutBtn" class="btn logout-btn"
                    style="width:100%;font-size:1.1rem;display:flex;align-items:center;justify-content:center;gap:8px;">
                    <span class="material-icons" style="vertical-align:middle;">logout</span> Logout
                </button>
            </div>
        </div>
    </div>
    <style>
        .modal {
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(30, 32, 60, 0.18);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 32px rgba(0, 0, 0, 0.13);
            position: relative;
        }
    </style>
    <script>
        // Dashboard summary and recent activity
        function getTasks() {
            try {
                return JSON.parse(localStorage.getItem('tasks')) || [];
            } catch {
                return [];
            }
        }

        function updateDashboardCards() {
            const tasks = getTasks();
            document.getElementById('card-total-tasks').textContent = tasks.length;
            const completed = tasks.filter(t => t.status === 'Completed').length;
            document.getElementById('card-completed-tasks').textContent = completed;
            const pending = tasks.filter(t => t.status !== 'Completed').length;
            document.getElementById('card-pending-tasks').textContent = pending;
        }

        function updateRecentActivity() {
            const tasks = getTasks();
            const recent = tasks.slice(-5).reverse();
            const ul = document.getElementById('recent-activity-list');
            ul.innerHTML = recent.length ? recent.map(t => `<li><b>${t.title}</b> - <span style='color:${t.status === 'Completed' ? '#28a745' : '#007bff'}'>${t.status}</span> <span style='color:#888'>(Due: ${t.deadline})</span></li>`).join('') : '<li>No recent activity.</li>';
        }

        document.addEventListener('DOMContentLoaded', function () {
            updateDashboardCards();
            updateRecentActivity();
        });

        // Profile modal logic
        const profileBtn = document.getElementById('profileIconBtn');
        const profileModal = document.getElementById('profileModal');
        const closeProfileModal = document.getElementById('closeProfileModal');
        const viewMyTasksBtn = document.getElementById('viewMyTasksBtn');
        const profileLogoutBtn = document.getElementById('profileLogoutBtn');
        profileBtn.onclick = function () {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            document.getElementById('profileName').textContent = user?.name || user?.username || 'User';
            document.getElementById('profileRole').textContent = user?.role || '';
            document.getElementById('profileEmail').textContent = user?.email || '';
            profileModal.style.display = 'flex';
        };
        closeProfileModal.onclick = function () { profileModal.style.display = 'none'; };
        window.onclick = function (event) {
            if (event.target === profileModal) profileModal.style.display = 'none';
        };
        viewMyTasksBtn.onclick = function () {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (user?.role && user.role.toLowerCase() === 'admin') {
                window.location.href = 'all-tasks.html';
            } else {
                const username = encodeURIComponent(user?.username || user?.name || '');
                window.location.href = 'all-tasks.html?user=' + username;
            }
        };
        profileLogoutBtn.onclick = function () {
            if (typeof logout === 'function') {
                logout();
            } else {
                localStorage.removeItem('currentUser');
                window.location.href = 'welcome.html';
            }
        };
    </script>
</body>

</html>